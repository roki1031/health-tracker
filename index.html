<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>个人健康管理系统</title>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"/>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
body { background: #f8f9fa; }
.container { max-width: 900px; margin-top: 20px; }
.card { margin-bottom: 20px; }
</style>
</head>
<body>
<div class="container">
  <h1 class="mb-4 text-center">个人健康管理系统</h1>

  <!-- 任务记录 -->
  <div class="card">
    <div class="card-header">今日任务</div>
    <div class="card-body">
      <form id="taskForm">
        <div class="mb-2">
          <label>饮食达标</label>
          <select id="diet" class="form-select">
            <option value="0">未完成</option>
            <option value="1">已完成</option>
          </select>
        </div>
        <div class="mb-2">
          <label>运动时长(分钟)</label>
          <input type="number" id="exercise" class="form-control" min="0"/>
        </div>
        <div class="mb-2">
          <label>康复训练(O型腿+拇趾外翻)</label>
          <select id="rehab" class="form-select">
            <option value="0">未完成</option>
            <option value="1">已完成</option>
          </select>
        </div>
        <div class="mb-2">
          <label>膝盖疼痛评分(0-10)</label>
          <input type="number" id="kneePain" class="form-control" min="0" max="10"/>
        </div>
        <div class="mb-2">
          <label>脚趾疼痛评分(0-10)</label>
          <input type="number" id="toePain" class="form-control" min="0" max="10"/>
        </div>
        <button type="submit" class="btn btn-primary mt-2">保存今日任务</button>
      </form>
    </div>
  </div>

  <!-- 指标记录 -->
  <div class="card">
    <div class="card-header">健康指标记录</div>
    <div class="card-body">
      <form id="metricsForm">
        <div class="mb-2">
          <label>体重(kg)</label>
          <input type="number" id="weight" class="form-control" step="0.1"/>
        </div>
        <div class="mb-2">
          <label>腰围(cm)</label>
          <input type="number" id="waist" class="form-control" step="0.1"/>
        </div>
        <div class="mb-2">
          <label>血压(mmHg)</label>
          <input type="text" id="bp" class="form-control" placeholder="120/80"/>
        </div>
        <div class="mb-2">
          <label>甘油三酯(mmol/L)</label>
          <input type="number" id="tg" class="form-control" step="0.01"/>
        </div>
        <div class="mb-2">
          <label>肌酐(umol/L)</label>
          <input type="number" id="creatinine" class="form-control" step="0.1"/>
        </div>
        <div class="mb-2">
          <label>CA242(IU/ml)</label>
          <input type="number" id="ca242" class="form-control" step="0.01"/>
        </div>
        <div class="mb-2">
          <label>SCC(ng/ml)</label>
          <input type="number" id="scc" class="form-control" step="0.01"/>
        </div>
        <button type="submit" class="btn btn-success mt-2">保存指标</button>
      </form>
    </div>
  </div>

  <!-- 趋势图 -->
  <div class="card">
    <div class="card-header">指标趋势图</div>
    <div class="card-body">
      <canvas id="trendChart"></canvas>
    </div>
  </div>

  <!-- 导出数据 -->
  <div class="text-center mb-4">
    <button id="exportBtn" class="btn btn-warning">导出数据(JSON)</button>
  </div>
</div>

<script>
let dataStore = JSON.parse(localStorage.getItem('healthData') || '{"tasks":[],"metrics":[]}');

function saveData(){
  localStorage.setItem('healthData', JSON.stringify(dataStore));
  renderChart();
}

document.getElementById('taskForm').addEventListener('submit', e=>{
  e.preventDefault();
  const record = {
    date: new Date().toISOString().split('T')[0],
    diet: parseInt(diet.value),
    exercise: parseInt(exercise.value) || 0,
    rehab: parseInt(rehab.value),
    kneePain: parseInt(kneePain.value) || 0,
    toePain: parseInt(toePain.value) || 0
  };
  dataStore.tasks.push(record);
  saveData();
  alert('今日任务已保存');
});

document.getElementById('metricsForm').addEventListener('submit', e=>{
  e.preventDefault();
  const record = {
    date: new Date().toISOString().split('T')[0],
    weight: parseFloat(weight.value) || null,
    waist: parseFloat(waist.value) || null,
    bp: bp.value || null,
    tg: parseFloat(tg.value) || null,
    creatinine: parseFloat(creatinine.value) || null,
    ca242: parseFloat(ca242.value) || null,
    scc: parseFloat(scc.value) || null
  };
  dataStore.metrics.push(record);
  saveData();
  alert('指标已保存');
});

document.getElementById('exportBtn').addEventListener('click', ()=>{
  const blob = new Blob([JSON.stringify(dataStore, null, 2)], {type: 'application/json'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = 'healthData.json';
  a.click();
  URL.revokeObjectURL(url);
});

let chart;
function renderChart(){
  const labels = dataStore.metrics.map(m => m.date);
  const tgData = dataStore.metrics.map(m => m.tg);
  const creatinineData = dataStore.metrics.map(m => m.creatinine);
  const ca242Data = dataStore.metrics.map(m => m.ca242);
  const sccData = dataStore.metrics.map(m => m.scc);

  const ctx = document.getElementById('trendChart').getContext('2d');
  if(chart) chart.destroy();
  chart = new Chart(ctx, {
    type: 'line',
    data: {
      labels,
      datasets: [
        { label: '甘油三酯', data: tgData, borderColor: 'red', fill: false },
        { label: '肌酐', data: creatinineData, borderColor: 'blue', fill: false },
        { label: 'CA242', data: ca242Data, borderColor: 'green', fill: false },
        { label: 'SCC', data: sccData, borderColor: 'orange', fill: false }
      ]
    },
    options: { responsive: true, plugins: { legend: { position: 'bottom' } } }
  });
}

renderChart();
</script>
</body>
</html>
