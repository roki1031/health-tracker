<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>个人健康管理系统</title>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"/>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
<style>
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  min-height: 100vh;
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  position: relative;
  overflow-x: hidden;
}

body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: 
    radial-gradient(circle at 20% 80%, rgba(120, 119, 198, 0.3) 0%, transparent 50%),
    radial-gradient(circle at 80% 20%, rgba(255, 119, 198, 0.3) 0%, transparent 50%),
    radial-gradient(circle at 40% 40%, rgba(120, 219, 255, 0.3) 0%, transparent 50%);
  animation: float 20s ease-in-out infinite;
  z-index: -1;
}

@keyframes float {
  0%, 100% { transform: translateY(0px) rotate(0deg); }
  50% { transform: translateY(-20px) rotate(180deg); }
}

.particles {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  overflow: hidden;
  z-index: -1;
}

.particle {
  position: absolute;
  background: rgba(255, 255, 255, 0.1);
  border-radius: 50%;
  animation: particle-float 15s linear infinite;
}

@keyframes particle-float {
  0% {
    transform: translateY(100vh) translateX(0px);
    opacity: 0;
  }
  10% {
    opacity: 1;
  }
  90% {
    opacity: 1;
  }
  100% {
    transform: translateY(-100vh) translateX(100px);
    opacity: 0;
  }
}

.container {
  max-width: 1200px;
  margin: 20px auto;
  padding: 0 20px;
}

.main-title {
  text-align: center;
  color: white;
  font-size: 3rem;
  font-weight: bold;
  margin: 40px 0;
  text-shadow: 0 0 20px rgba(255, 255, 255, 0.5);
  animation: glow 2s ease-in-out infinite alternate;
}

@keyframes glow {
  from { text-shadow: 0 0 20px rgba(255, 255, 255, 0.5); }
  to { text-shadow: 0 0 30px rgba(255, 255, 255, 0.8), 0 0 40px rgba(255, 255, 255, 0.6); }
}

.card {
  background: rgba(255, 255, 255, 0.1);
  backdrop-filter: blur(10px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
  transition: all 0.3s ease;
  margin-bottom: 30px;
  overflow: hidden;
}

.card:hover {
  transform: translateY(-5px);
  box-shadow: 0 12px 40px rgba(0, 0, 0, 0.2);
}

.card-header {
  background: linear-gradient(45deg, #667eea, #764ba2);
  color: white;
  font-weight: bold;
  border: none;
  padding: 20px;
  text-align: center;
  font-size: 1.2rem;
  position: relative;
  overflow: hidden;
}

.card-header::before {
  content: '';
  position: absolute;
  top: -50%;
  left: -50%;
  width: 200%;
  height: 200%;
  background: linear-gradient(
    45deg,
    transparent,
    rgba(255, 255, 255, 0.1),
    transparent
  );
  transform: rotate(45deg);
  animation: shine 3s infinite;
}

@keyframes shine {
  0% { transform: translateX(-100%) translateY(-100%) rotate(45deg); }
  100% { transform: translateX(100%) translateY(100%) rotate(45deg); }
}

.form-control, .form-select {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.3);
  border-radius: 10px;
  color: white;
  backdrop-filter: blur(5px);
  transition: all 0.3s ease;
}

.form-control:focus, .form-select:focus {
  background: rgba(255, 255, 255, 0.2);
  border-color: #667eea;
  box-shadow: 0 0 0 0.2rem rgba(102, 126, 234, 0.25);
  color: white;
}

.form-control::placeholder {
  color: rgba(255, 255, 255, 0.7);
}

label {
  color: rgba(255, 255, 255, 0.9);
  font-weight: 500;
  margin-bottom: 8px;
}

.btn {
  border-radius: 50px;
  padding: 12px 30px;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 1px;
  border: none;
  cursor: pointer;
  position: relative;
  overflow: hidden;
  transition: all 0.3s ease;
}

.btn::before {
  content: '';
  position: absolute;
  top: 0;
  left: -100%;
  width: 100%;
  height: 100%;
  background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
  transition: left 0.5s;
}

.btn:hover::before {
  left: 100%;
}

.btn-primary {
  background: linear-gradient(45deg, #667eea, #764ba2);
  box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
}

.btn-primary:hover {
  transform: translateY(-2px);
  box-shadow: 0 6px 20px rgba(102, 126, 234, 0.6);
}

.btn-success {
  background: linear-gradient(45deg, #56ab2f, #a8e6cf);
  box-shadow: 0 4px 15px rgba(86, 171, 47, 0.4);
}

.btn-success:hover {
  transform: translateY(-2px);
  box-shadow: 0 6px 20px rgba(86, 171, 47, 0.6);
}

.btn-warning {
  background: linear-gradient(45deg, #ffa726, #fb8c00);
  box-shadow: 0 4px 15px rgba(255, 167, 38, 0.4);
}

.btn-warning:hover {
  transform: translateY(-2px);
  box-shadow: 0 6px 20px rgba(255, 167, 38, 0.6);
}

.stats-container {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
  gap: 20px;
  margin-bottom: 30px;
}

.stat-card {
  background: rgba(255, 255, 255, 0.15);
  border-radius: 15px;
  padding: 20px;
  text-align: center;
  backdrop-filter: blur(10px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: transform 0.3s ease;
}

.stat-card:hover {
  transform: scale(1.05);
}

.stat-number {
  font-size: 2.5rem;
  font-weight: bold;
  color: white;
  margin-bottom: 10px;
}

.stat-label {
  color: rgba(255, 255, 255, 0.8);
  font-size: 0.9rem;
}

.toast-custom {
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  background: linear-gradient(45deg, #56ab2f, #a8e6cf);
  color: white;
  padding: 15px 30px;
  border-radius: 50px;
  box-shadow: 0 4px 15px rgba(86, 171, 47, 0.4);
  z-index: 9999;
  font-weight: 600;
}

@media (max-width: 768px) {
  .main-title {
    font-size: 2rem;
    margin: 20px 0;
  }
  
  .container {
    margin: 10px auto;
    padding: 0 15px;
  }
  
  .stats-container {
    grid-template-columns: 1fr;
  }
}
</style>
</head>
<body>
<div class="particles" id="particles"></div>
<div class="container">
  <h1 class="main-title animate__animated animate__fadeInDown">个人健康管理系统</h1>
  
  <div id="summaryStats" class="stats-container animate__animated animate__fadeInUp"></div>

  <div class="card animate__animated animate__fadeInUp">
    <div class="card-header">
      <i class="fas fa-calendar-check"></i> 今日任务
    </div>
    <div class="card-body">
      <form id="taskForm">
        <div class="mb-3">
          <label class="form-label">饮食达标</label>
          <select id="diet" class="form-select">
            <option value="0">❌ 未完成</option>
            <option value="1">✅ 已完成</option>
          </select>
        </div>
        <div class="mb-3">
          <label class="form-label">🏃‍♂️ 运动时长 (分钟)</label>
          <input type="number" id="exercise" class="form-control" min="0" placeholder="例如: 30">
        </div>
        <div class="mb-3">
          <label class="form-label">🧘‍♂️ 康复训练 (O型腿+拇趾外翻)</label>
          <select id="rehab" class="form-select">
            <option value="0">❌ 未完成</option>
            <option value="1">✅ 已完成</option>
          </select>
        </div>
        <div class="mb-3">
          <label class="form-label">🦵 膝盖疼痛评分 (0-10分)</label>
          <input type="range" class="form-range" id="kneePain" min="0" max="10" value="0">
          <div class="text-center mt-2">
            <span id="kneePainValue" class="badge bg-info">0分</span>
          </div>
        </div>
        <div class="mb-3">
          <label class="form-label">🦶 脚趾疼痛评分 (0-10分)</label>
          <input type="range" class="form-range" id="toePain" min="0" max="10" value="0">
          <div class="text-center mt-2">
            <span id="toePainValue" class="badge bg-info">0分</span>
          </div>
        </div>
        <button type="submit" class="btn btn-primary w-100">
          <i class="fas fa-save"></i> 保存今日任务
        </button>
      </form>
    </div>
  </div>

  <div class="card animate__animated animate__fadeInUp">
    <div class="card-header">
      <i class="fas fa-chart-line"></i> 健康指标记录
    </div>
    <div class="card-body">
      <form id="metricsForm">
        <div class="row">
          <div class="col-md-6 mb-3">
            <label class="form-label">⚖️ 体重 (kg)</label>
            <input type="number" id="weight" class="form-control" step="0.1" placeholder="例如: 70.5">
          </div>
          <div class="col-md-6 mb-3">
            <label class="form-label">📏 腰围 (cm)</label>
            <input type="number" id="waist" class="form-control" step="0.1" placeholder="例如: 85">
          </div>
        </div>
        <div class="row">
          <div class="col-md-6 mb-3">
            <label class="form-label">❤️ 血压 (mmHg)</label>
            <input type="text" id="bp" class="form-control" placeholder="例如: 120/80">
          </div>
          <div class="col-md-6 mb-3">
            <label class="form-label">📊 甘油三酯 (mmol/L)</label>
            <input type="number" id="tg" class="form-control" step="0.01" placeholder="例如: 1.5">
          </div>
        </div>
        <div class="row">
          <div class="col-md-4 mb-3">
            <label class="form-label">⚗️ 肌酐 (umol/L)</label>
            <input type="number" id="creatinine" class="form-control" step="0.1" placeholder="例如: 80">
          </div>
          <div class="col-md-4 mb-3">
            <label class="form-label">🔬 CA242 (IU/ml)</label>
            <input type="number" id="ca242" class="form-control" step="0.01" placeholder="例如: 15">
          </div>
          <div class="col-md-4 mb-3">
            <label class="form-label">🧪 SCC (ng/ml)</label>
            <input type="number" id="scc" class="form-control" step="0.01" placeholder="例如: 1.2">
          </div>
        </div>
        <button type="submit" class="btn btn-success w-100">
          <i class="fas fa-chart-bar"></i> 保存指标
        </button>
      </form>
    </div>
  </div>

  <div class="card animate__animated animate__fadeInUp">
    <div class="card-header">
      <i class="fas fa-chart-line"></i> 指标趋势图
    </div>
    <div class="card-body">
      <canvas id="trendChart" height="100"></canvas>
    </div>
  </div>

  <div class="text-center mb-4 animate__animated animate__fadeInUp">
    <button id="exportBtn" class="btn btn-warning">
      <i class="fas fa-download"></i> 导出数据 (JSON)
    </button>
  </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/js/all.min.js"></script>
<script>
let dataStore = JSON.parse(localStorage.getItem('healthData') || '{"tasks":[],"metrics":[]}');

function saveData() {
  localStorage.setItem('healthData', JSON.stringify(dataStore));
  renderChart();
  updateSummary();
}

// 更新疼痛评分显示
function updatePainDisplay() {
  const kneePainInput = document.getElementById('kneePain');
  const toePainInput = document.getElementById('toePain');
  
  if (kneePainInput) {
    kneePainInput.addEventListener('input', function() {
      document.getElementById('kneePainValue').textContent = this.value + '分';
    });
  }
  
  if (toePainInput) {
    toePainInput.addEventListener('input', function() {
      document.getElementById('toePainValue').textContent = this.value + '分';
    });
  }
}

// 更新统计摘要
function updateSummary() {
  const stats = document.getElementById('summaryStats');
  const tasks = dataStore.tasks.slice(-7);
  
  if (tasks.length === 0) {
    stats.innerHTML = '<p class="text-center text-white animate__animated animate__fadeIn">还没有数据，开始记录您的健康信息吧！</p>';
    return;
  }
  
  const totalDays = tasks.length;
  const dietCompleted = tasks.filter(t => t.diet === 1).length;
  const totalExercise = tasks.reduce((sum, t) => sum + (t.exercise || 0), 0);
  const rehabCompleted = tasks.filter(t => t.rehab === 1).length;
  
  const avgExercise = Math.round(totalExercise / totalDays);
  const dietRate = Math.round((dietCompleted / totalDays) * 100);
  const rehabRate = Math.round((rehabCompleted / totalDays) * 100);
  
  stats.innerHTML = `
    <div class="stat-card animate__animated animate__fadeInLeft">
      <div class="stat-number">${dietRate}%</div>
      <div class="stat-label">饮食达标率</div>
    </div>
    <div class="stat-card animate__animated animate__fadeInUp">
      <div class="stat-number">${avgExercise}</div>
      <div class="stat-label">平均运动(分钟/天)</div>
    </div>
    <div class="stat-card animate__animated animate__fadeInRight">
      <div class="stat-number">${rehabRate}%</div>
      <div class="stat-label">康复训练完成率</div>
    </div>
    <div class="stat-card animate__animated animate__fadeInUp">
      <div class="stat-number">${totalDays}</div>
      <div class="stat-label">记录天数</div>
    </div>
  `;
}

// 显示成功提示
function showToast(message) {
  const toast = document.createElement('div');
  toast.className = 'toast-custom animate__animated animate__fadeInDown';
  toast.innerHTML = `
    <i class="fas fa-check-circle me-2"></i>
    ${message}
  `;
  document.body.appendChild(toast);
  
  setTimeout(() => {
    toast.classList.replace('animate__fadeInDown', 'animate__fadeOutUp');
    setTimeout(() => toast.remove(), 500);
  }, 2000);
}

document.getElementById('taskForm').addEventListener('submit', function(e) {
  e.preventDefault();
  const button = this.querySelector('button[type="submit"]');
  button.innerHTML = '<span class="spinner-border spinner-border-sm" role="status"></span> 保存中...';
  
  setTimeout(() => {
    const record = {
      date: new Date().toISOString().split('T')[0],
      diet: parseInt(document.getElementById('diet').value),
      exercise: parseInt(document.getElementById('exercise').value) || 0,
      rehab: parseInt(document.getElementById('rehab').value),
      kneePain: parseInt(document.getElementById('kneePain').value) || 0,
      toePain: parseInt(document.getElementById('toePain').value) || 0
    };
    
    dataStore.tasks.push(record);
    saveData();
    
    button.innerHTML = '<i class="fas fa-save"></i> 保存今日任务';
    this.reset();
    showToast('今日任务已保存！');
  }, 1000);
});

document.getElementById('metricsForm').addEventListener('submit', function(e) {
  e.preventDefault();
  const button = this.querySelector('button[type="submit"]');
  button.innerHTML = '<span class="spinner-border spinner-border-sm" role="status"></span> 保存中...';
  
  setTimeout(() => {
    const record = {
      date: new Date().toISOString().split('T')[0],
      weight: parseFloat(document.getElementById('weight').value) || null,
      waist: parseFloat(document.getElementById('waist').value) || null,
      bp: document.getElementById('bp').value || null,
      tg: parseFloat(document.getElementById('tg').value) || null,
      creatinine: parseFloat(document.getElementById('creatinine').value) || null,
      ca242: parseFloat(document.getElementById('ca242').value) || null,
      scc: parseFloat(document.getElementById('scc').value) || null
    };
    
    dataStore.metrics.push(record);
    saveData();
    
    button.innerHTML = '<i class="fas fa-chart-bar"></i> 保存指标';
    this.reset();
    showToast('指标已保存！');
  }, 1000);
});

document.getElementById('exportBtn').addEventListener('click', function() {
  const originalText = this.innerHTML;
  this.innerHTML = '<span class="spinner-border spinner-border-sm" role="status"></span> 导出中...';
  
  setTimeout(() => {
    const blob = new Blob([JSON.stringify(dataStore, null, 2)], {type: 'application/json'});
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = 'healthData.json';
    a.click();
    URL.revokeObjectURL(url);
    
    this.innerHTML = originalText;
    showToast('数据导出成功！');
  }, 1000);
});

let chart;
function renderChart() {
  // 设置Chart.js默认样式
  Chart.defaults.color = 'rgba(255, 255, 255, 0.8)';
  Chart.defaults.borderColor = 'rgba(255, 255, 255, 0.2)';
  Chart.defaults.backgroundColor = 'rgba(255, 255, 255, 0.1)';
  
  const labels = dataStore.metrics.map(m => m.date);
  const tgData = dataStore.metrics.map(m => m.tg);
  const creatinineData = dataStore.metrics.map(m => m.creatinine);
  const ca242Data = dataStore.metrics.map(m => m.ca242);
  const sccData = dataStore.metrics.map(m => m.scc);

  const ctx = document.getElementById('trendChart').getContext('2d');
  if (chart) chart.destroy();
  
  const gradientRed = ctx.createLinearGradient(0, 0, 0, 400);
  gradientRed.addColorStop(0, 'rgba(255, 99, 132, 0.2)');
  gradientRed.addColorStop(1, 'rgba(255, 99, 132, 0)');
  
  const gradientBlue = ctx.createLinearGradient(0, 0, 0, 400);
  gradientBlue.addColorStop(0, 'rgba(54, 162, 235, 0.2)');
  gradientBlue.addColorStop(1, 'rgba(54, 162, 235, 0)');
  
  const gradientGreen = ctx.createLinearGradient(0, 0, 0, 400);
  gradientGreen.addColorStop(0, 'rgba(75, 192, 192, 0.2)');
  gradientGreen.addColorStop(1, 'rgba(75, 192, 192, 0)');
  
  const gradientOrange = ctx.createLinearGradient(0, 0, 0, 400);
  gradientOrange.addColorStop(0, 'rgba(255, 159, 64, 0.2)');
  gradientOrange.addColorStop(1, 'rgba(255, 159, 64, 0)');

  chart = new Chart(ctx, {
    type: 'line',
    data: {
      labels,
      datasets: [
        {
          label: '甘油三酯',
          data: tgData,
          borderColor: '#ff6384',
          backgroundColor: gradientRed,
          fill: true,
          tension: 0.4,
          borderWidth: 3,
          pointRadius: 6,
          pointBackgroundColor: '#fff',
          pointBorderColor: '#ff6384',
          pointBorderWidth: 2
        },
        {
          label: '肌酐',
          data: creatinineData,
          borderColor: '#36a2eb',
          backgroundColor: gradientBlue,
          fill: true,
          tension: 0.4,
          borderWidth: 3,
          pointRadius: 6,
          pointBackgroundColor: '#fff',
          pointBorderColor: '#36a2eb',
          pointBorderWidth: 2
        },
        {
          label: 'CA242',
          data: ca242Data,
          borderColor: '#4bc0c0',
          backgroundColor: gradientGreen,
          fill: true,
          tension: 0.4,
          borderWidth: 3,
          pointRadius: 6,
          pointBackgroundColor: '#fff',
          pointBorderColor: '#4bc0c0',
          pointBorderWidth: 2
        },
        {
          label: 'SCC',
          data: sccData,
          borderColor: '#ff9f40',
          backgroundColor: gradientOrange,
          fill: true,
          tension: 0.4,
          borderWidth: 3,
          pointRadius: 6,
          pointBackgroundColor: '#fff',
          pointBorderColor: '#ff9f40',
          pointBorderWidth: 2
        }
      ]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      plugins: {
        legend: {
          position: 'top',
          labels: {
            usePointStyle: true,
            padding: 20,
            font: {
              size: 14,
              weight: 'bold'
            }
          }
        }
      },
      scales: {
        x: {
          grid: {
            color: 'rgba(255, 255, 255, 0.1)'
          },
          ticks: {
            color: 'rgba(255, 255, 255, 0.8)'
          }
        },
        y: {
          grid: {
            color: 'rgba(255, 255, 255, 0.1)'
          },
          ticks: {
            color: 'rgba(255, 255, 255, 0.8)'
          }
        }
      },
      interaction: {
        intersect: false,
        mode: 'index'
      }
    }
  });
}

// 初始化
(function() {
  // 创建粒子动画
  function createParticles() {
    const particlesContainer = document.getElementById('particles');
    for (let i = 0; i < 50; i++) {
      const particle = document.createElement('div');
      particle.className = 'particle';
      particle.style.left = Math.random() * 100 + '%';
      particle.style.animationDelay = Math.random() * 15 + 's';
      particle.style.animationDuration = (Math.random() * 10 + 10) + 's';
      particle.style.width = Math.random() * 5 + 2 + 'px';
      particle.style.height = particle.style.width;
      particlesContainer.appendChild(particle);
    }
  }

  // 滚动显示动画
  const observerOptions = {
    threshold: 0.1,
    rootMargin: '0px 0px -50px 0px'
  };

  const observer = new IntersectionObserver(function(entries) {
    entries.forEach(entry => {
      if (entry.isIntersecting) {
        entry.target.classList.add('animate__animated', 'animate__fadeInUp');
      }
    });
  }, observerOptions);

  document.querySelectorAll('.card').forEach((card, index) => {
    card.style.animationDelay = `${index * 0.2}s`;
    observer.observe(card);
  });

  createParticles();
  updatePainDisplay();
  renderChart();
  updateSummary();
})();
</script>
</body>
</html>